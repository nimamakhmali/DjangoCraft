<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Student Marketplace{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    </style>
    {% block head_extra %}{% endblock %}
    {% csrf_token %}
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
    <header class="bg-white border-b">
      <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
        <a href="/" class="font-semibold">Student Marketplace</a>
        <nav class="text-sm flex gap-4">
          <a class="text-gray-600 hover:text-blue-600" href="/services/page/">Services</a>
          <a class="text-gray-600 hover:text-blue-600" href="/api/docs/" target="_blank">API Docs</a>
          <a class="text-gray-600 hover:text-blue-600" href="/admin/">Django Admin</a>
        </nav>
        <div class="text-sm flex items-center gap-2" id="authBox">
          <a class="px-2 py-1 border rounded" href="/auth/login/">Login</a>
          <a class="px-2 py-1 border rounded" href="/auth/signup/">Signup</a>
        </div>
      </div>
    </header>
    <main class="max-w-6xl mx-auto px-4 py-6">
      {% block content %}{% endblock %}
    </main>
    <footer class="text-xs text-gray-500 py-8 text-center">Â© {% now "Y" %} Student Marketplace</footer>

    <script>
      // Minimal auth UI helper that checks /api/accounts/me/
      (async function initAuth(){
        try {
          const res = await fetch('/api/accounts/me/');
          if (!res.ok) return;
          const me = await res.json();
          const box = document.getElementById('authBox');
          if (box) {
            box.innerHTML = `<span class="text-gray-600">${me.username}</span>` +
              `<button id="logoutBtn" class="ml-2 px-2 py-1 border rounded">Logout</button>`;
            document.getElementById('logoutBtn')?.addEventListener('click', async ()=>{
              await fetch('/api/accounts/logout/', { method: 'POST', headers: { 'X-CSRFToken': getCookie('csrftoken') } });
              location.reload();
            });
          }
        } catch (e) { /* not logged in */ }
      })();
      function getCookie(name){
        const m = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
        return m ? m.pop() : '';
      }
    </script>
</body>
</html>


