{% extends 'base.html' %}
{% block title %}Messaging - Student Marketplace{% endblock %}
{% block content %}
  <h1 class="text-xl font-semibold mb-4">Conversations</h1>
  <div id="list" class="space-y-2"></div>
  <script>
    (async function(){
      const r = await fetch('/api/messaging/conversations/');
      const el = document.getElementById('list');
      if (r.status === 401) { el.innerHTML = 'Please login to view your conversations.'; return }
      if (!r.ok) { el.innerHTML = 'Failed to load conversations.'; return }
      const data = await r.json();
      const items = (data.results || []).map(c => `
        <div class="bg-white border rounded p-3 flex items-center justify-between">
          <div>
            <div class="font-medium">${c.title || 'Untitled'}</div>
            <div class="text-xs text-gray-500">${c.last_message_at || ''}</div>
          </div>
          ${c.unread_count > 0 ? `<span class="text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">${c.unread_count}</span>` : ''}
        </div>
      `).join('');
      el.innerHTML = items || '<div class="text-gray-500">No conversations.</div>';
    })();
  </script>
{% endblock %}



